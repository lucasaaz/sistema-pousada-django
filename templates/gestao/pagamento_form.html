<!-- ========================================================================== -->
<!-- ARQUIVO: templates/gestao/pagamento_form.html                              -->
<!-- ========================================================================== -->
{% extends 'base.html' %}
{% block title %}{% if object %}Editar Pagamento{% else %}Adicionar Pagamento{% endif %}{% endblock %}
{% block content %}
<main class="px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <div>
            <h1 class="h2">{% if object %}Editar Pagamento{% else %}Adicionar Pagamento{% endif %}</h1>
            {% if evento %}
                <h2 class="h5 text-muted">Para o Evento: {{ evento.nome_evento }}</h2>
            {% endif %}
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}

                <div class="card-footer">
                    {% if reserva %}
                        <a href="{% url 'reserva_detail' reserva.pk %}" class="btn btn-secondary">Cancelar</a>
                    {% elif evento %}
                        <a href="{% url 'evento_detail' evento.pk %}" class="btn btn-secondary">Cancelar</a>
                    {% endif %}
                    
                    <button type="submit" class="btn btn-primary">Salvar Pagamento</button>
                </div>
            </form>
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 1. Pega os elementos do formulário
    const formaPagamentoSelect = document.getElementById('{{ form.forma_pagamento.id_for_label }}');
    const qrCodeImage = document.getElementById('pix-qrcode-image');

    // 2. Mapeamento: qual texto corresponde a qual imagem
    const pixImageMap = {
        'pix': 'https://pousada-dos-azevedos.s3.sa-east-1.amazonaws.com/img/PIX.png',
        'pix - pedro': 'https://pousada-dos-azevedos.s3.sa-east-1.amazonaws.com/img/PIX_PEDRO.png',
        'pix - regina': 'URL_DA_IMAGEM_DA_REGINA' // Adicione outras conforme necessário
    };

    // 3. Função que atualiza a imagem
    function atualizarImagemPix() {
        const selectedOptionText = formaPagamentoSelect.options[formaPagamentoSelect.selectedIndex].text.toLowerCase();
        
        // Procura a URL correspondente no mapa
        const imageUrl = pixImageMap[selectedOptionText];

        if (imageUrl) {
            // Se encontrou uma URL, define o 'src' da imagem e a exibe
            qrCodeImage.src = imageUrl;
            qrCodeImage.style.display = 'block';
        } else {
            // Se não for uma opção de PIX, esconde a imagem
            qrCodeImage.style.display = 'none';
        }
    }

    // 4. Adiciona um "escutador" que chama a função toda vez que o select mudar
    formaPagamentoSelect.addEventListener('change', atualizarImagemPix);

    // 5. Chama a função uma vez no carregamento da página para definir o estado inicial
    atualizarImagemPix();
});
</script>
{% endblock %}